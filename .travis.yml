# Repository CI using Travis on amd64 machines
#

language: python
python:
    - "3.8"
env:
    global:
        - PORTAGE_VER="3.0.7"
    jobs:
        - REPOMAN=1
        - PKGCHECK=1
        - PACKAGES=1
before_install:
    - sudo apt-get -qq update
    - pip install lxml pyyaml pkgcheck
before_script:
    - sudo chmod a+rwX /etc/passwd /etc/group /etc /var /var/cache
    - mkdir -p travis-overlay /etc/portage /var/cache/distfiles /var/db/repos/gentoo
    - wget -qO - "https://github.com/gentoo/portage/archive/portage-${PORTAGE_VER}.tar.gz" | tar xz
    - wget -qO - "https://github.com/gentoo-mirror/gentoo/archive/master.tar.gz" | tar xz -C /var/db/repos/gentoo --strip-components=1
    - echo "portage:x:250:250:portage:/var/tmp/portage:/bin/false" >> /etc/passwd
    - echo "portage::250:portage,travis" >> /etc/group
    - wget "https://www.gentoo.org/dtd/metadata.dtd" -O /var/cache/distfiles/metadata.dtd
    - ln -s $TRAVIS_BUILD_DIR/portage-portage-${PORTAGE_VER}/cnf/repos.conf /etc/portage/repos.conf
    - ln -s /var/db/repos/gentoo/profiles/default/linux/amd64/17.0 /etc/portage/make.profile
script:
    - .travis/travis_ci.sh
